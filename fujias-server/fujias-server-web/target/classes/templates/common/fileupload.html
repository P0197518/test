<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/header::commonHeader(~{::head/meta},~{::head/title},~{},~{::head/script},~{})">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>ファイルアップロード</title>

    <meta name="description" content="overview &amp; stats" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <script th:src="@{/js/jquery.form.js}" type="text/javascript"></script>

</head>

<body class="no-skin" style="overflow-y:hidden;overflow-x:hidden">

    <!-- /section:basics/navbar.layout -->
    <div th:object="${formdata}" class="main-container ace-save-state" id="main-container">
        <script type="text/javascript">
            try {
                ace.settings.loadState('main-container')
            } catch (e) {}
        </script>

    <form th:action="@{/fileUpload/importData}" method="post" enctype="multipart/form-data">
        <input id="importType" th:field="*{importType}" type="hidden" />
        <div>
            <div class="tab-content profile-edit-tab-content">

                <div id="edit-basic" class="tab-pane in active">
                    <div class="form-group" style="height:30px;text-align:center;margin-bottom:50px;">
                        <a href="javascript:void(0);" onclick="downSample();" >導入サンプルをダウンロードする</a>
                    </div>
                    <div class="form-group" style="height:30px;text-align:center;margin-bottom:20px;">
                        <input name="importData" id="importData" type="file" />
                    </div>
                    <div class="form-group" style="height:30px;text-align:center;margin-bottom:20px;">
                        <button class="btn btn-info btn-round" type="button" onclick="upload()">
                                            <i class="ace-icon glyphicon glyphicon-upload"> </i> アップロード
                                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
       
        <!-- /.row -->
    </div>
</body>
<script>

    function upload() {
        
        if(document.getElementById("importData").value == ""){
            businessMessage.alert("E00028");
            return;
        }
        
        var hideForm = $('form');
        var options = {
            dataType : "json",
            beforeSubmit : function() {
                
            },
            success : function(result) {
                if(result.status == "ERROR"){
                    businessMessage.alert(result.text,result.args);
                }else if(result.status == "CHECKERROR"){
                	result.checkMessages = JSON.parse(result.text);
                    //问合作成：有错误数据情况下要将正确的数据导入
                    if(document.getElementById("importType").value == '1'){
                    	for(var i = result.checkMessages.length - 1; i >=0; i--){
                    		result.data.splice(result.checkMessages[i].row - 1,1);
                    	}
                    	CloseWindow(result);
                    }else{
                        showError(result);
                    }
                } else{
                    CloseWindow(result);
                }
                
            },
            error : function(result) {
            }
        };
        hideForm.ajaxSubmit(options);
    }
    
    function downSample(){
        
        var downloadUrl = concatUrl(bootPATH,"/fileUpload/downSample") 
          + "?importType="+document.getElementById("importType").value;
        window.open(downloadUrl);
    }
</script>

</html>