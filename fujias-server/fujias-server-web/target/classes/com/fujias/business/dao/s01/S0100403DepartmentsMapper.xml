<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fujias.business.dao.s01.S0100403DepartmentsMapper">
    <select id="selectAll"
        resultType="com.fujias.business.forms.s01.S0100403DepartmentsForm">
        select
        createtime, createuser, updatetime, updateuser,
        delflg,
        id, name, parentid, depid
        from mdepartment
        where
        delflg = '0'
        order by depid
    </select>
    <select id="selectById" parameterType="String"
        resultType="com.fujias.business.forms.s01.S0100403DepartmentsForm">
        select
        createtime, createuser, updatetime, updateuser,
        delflg,
        id, name, parentid, depid
        from mdepartment
        where
        delflg = '0'
        and id = #{id}
    </select>
    <select id="selectByParentId" parameterType="String"
        resultType="com.fujias.business.forms.s01.S0100403DepartmentsForm">
        select
        createtime, createuser, updatetime, updateuser,
        delflg,
        id, name, parentid, depid
        from mdepartment
        where
        delflg = '0'
        and parentid = #{parentid}
    </select>
    <!-- 部门下拉列表 -->
    <select id="getDepartmentOptions" resultType="com.fujias.common.entity.SelectItem">
        select
        depid AS value,
        name AS text
        from
        mdepartment
        where
        delflg = '0'
        order by depid
    </select>
    <!-- 部门下拉列表 -->
    <select id="getUserDepartmentOptions" resultType="com.fujias.common.entity.SelectItem">
        select
        depid AS value,
        name AS text
        from
        mdepartment
        where
        delflg = '0'
        and depid not in (
            select
            parentid
            from mdepartment
            where delflg = '0'
        )
        order by depid
    </select>
    <select id="checkChildrenExist"
        parameterType="com.fujias.common.db.entity.MDepartment"
        resultType="Integer">
        select count(*)
        from mdepartment as dep
        where
        dep.delflg = '0'
        <if test="id != null and id != ''">
            AND dep.parentid = #{id}
        </if>
    </select>
    <select id="checkExist"
        parameterType="com.fujias.business.forms.s01.S0100403DepartmentsForm"
        resultType="Integer">
        select count(*)
        from mdepartment as dep
        where
        dep.delFlg = '0'
        AND dep.depId = #{depId}
        <if test="mode == 'update'">
        AND dep.id != #{id}
        </if>
    </select>
</mapper>