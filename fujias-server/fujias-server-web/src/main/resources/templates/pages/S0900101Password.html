<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:replace="common/header::commonHeader(~{::head/meta},~{::head/title},~{},~{},~{})">
    <title>パスワード変更</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
</head>

<body onload="loadfocus">
    <div class="edit-page-content">
        <div id="form1" th:object="${formdata}" class="form-horizontal" style="width: 100%; min-width: 800px;">
            <input id="mode" class="mini-hidden" th:field="*{mode}" />
            <div>
                <div class="tab-content profile-edit-tab-content">

                    <div id="edit-basic" class="tab-pane in active">
                        <h4 class="header blue bolder smaller">密码修改</h4>

                        <div class="vspace-12-sm"></div>
                        <div class="form-group">
                            <label class="col-xs-5 control-label" for="form-field-username">旧密码：
                                </label>

                            <div class="col-xs-2">
                                <input id="oldpassword" th:field="*{oldpassword}" class="mini-password" placeholder="" required="true" style="width:300px;" vtype="halfonly;rangeLength:1,13;" value="" />
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-xs-5 control-label" for="form-field-username">新密码 ：
                                </label>
                            <div class="col-xs-2">
                                <input id="password" th:field="*{password}" class="mini-password" placeholder="" required="true" value="" style="width:300px;" vtype="halfonly;rangeLength:5,13;" />
                            </div>

                        </div>
                        <div class="form-group">
                            <label class="col-xs-5 control-label" for="form-field-username">重新输入新密码：
                                </label>
                            <div class="col-xs-2">
                                <input id="confirmpassword" th:field="*{confirmpassword}" class="mini-password" placeholder="" required="true" value="" style="width:300px;" vtype="halfonly;rangeLength:5,13;" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; padding: 10px;">
                <a class="mini-button btn btn-info btn-round " onclick="onOk()" type="button">
                    <i class="ace-icon fa fa-floppy-o bigger-110"></i> 确 定
                </a> &nbsp; &nbsp;
                <a class="mini-button btn btn-warning btn-round" onclick="onCancel()" type="button">
                    <i class="ace-icon fa fa-undo bigger-110"></i> 取 消
                </a>
            </div>
        </div>
    </div>
    <!-- /.page-content -->

    <script type="text/javascript">
        var form = new mini.Form("#form1");
        mini.parse();

        function onOk() {
            form.validate();
            if (form.isValid() == false) {
                businessMessage.alert("E00006");
                return;
            }

            if (mini.get("oldpassword").getValue() == mini.get("password").getValue()) {
                businessMessage.alert("E00021");
                return;
            }

            if (mini.get("confirmpassword").getValue() != mini.get("password").getValue()) {
                businessMessage.alert("E00022");
                return;
            }
            var data = form.getData();
            doAjax("/S0900101Password/changePassword", data, function(obj) {
                if (obj.status == "SUCCESS") {
                    businessMessage.alert("IC0001", null, function() {
                        CloseWindow("ok");
                    });
                }
            });
        }

        // 初始化时focus
        function loadfocus() {
            mini.get("oldpassword").focus();
        }
    </script>
</body>

</html>