<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:replace="common/header::commonHeader(~{::head/meta},~{::head/title},~{},~{},~{})">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>[[#{S0100403.departall}]]</title>
</head>

<body class="no-skin">
    <input id="resourcecd" name="resourcecd" type="hidden" value="S0100403" />
    <div class="mini-toolbar" style="padding: 0px; border-top: 0; margin-top: 5px; margin-bottom: 5px;">
        <table style="width: 100%;">
            <tr>
                <td style="width:100%;height:30px;">
                    <a id="add" class="mini-button btn btn-warning btn-round autoAuth" onclick="add()" type="button">
                        <i class="ace-icon fa fa-plus-circle bigger-110"></i>[[#{add}]]
                    </a>
                    <a id="edit" class="mini-button btn btn-success btn-round autoAuth" onclick="edit()" type="button">
                        <i class="ace-icon fa fa-pencil-square-o"></i>[[#{update}]]
                    </a>
                    <a id="removeItem" class="mini-button btn btn-danger btn-round autoAuth" onclick="removeItem()" type="button">
                        <i class="ace-icon fa fa-times-circle"></i>[[#{delete}]]
                    </a>
                </td>
            </tr>
        </table>
    </div>

    <div class="mini-fit">
        <div id="grid" th:url="@{/S0100403Departments/getTreeList}" class="mini-treegrid" style="width: 100%; height: 100%;" showTreeIcon="true" treeColumn="name" idField="depid" parentField="parentid" resultAsTree="false" allowResize="false" expandOnLoad="true">
            <div property="columns">
                <div type="checkcolumn">[[#{S0100403.select}]]</div>
                <div field="depId" name="depId" width="50" headerAlign="center" align="center">[[#{S0100403.departno}]]</div>
                <div field="name" name="name" width="200" headerAlign="center">[[#{S0100403.departname}]]</div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        mini.parse();

        var grid = mini.get("grid");
        grid.load();

        function add() {
            var popupParam = openCommonPopupParam("/S0100403Departments/indexEdit",
                "[[#{S0100403.departadd}]]");
            popupParam.width = 460;
            popupParam.height = 350;
            popupParam.ondestroy = function(action) {
                if (action == "ok") {
                    grid.reload();
                }
            };
            mini.open(popupParam);
        }

        // 编辑操作
        function edit() {
            var rows = grid.getSelecteds();
            if (rows.length == 1) {
                var row = grid.getSelected();

                var popupParam = openCommonPopupParam(
                    "/S0100403Departments/indexEdit?id=" + row.id, "[[#{S0100403.departedit}]]");
                popupParam.width = 460;
                popupParam.height = 350;
                popupParam.ondestroy = function(action) {
                    if (action == "ok") {
                        grid.reload();
                    }
                };
                mini.open(popupParam);
            } else {
                businessMessage.alert("E00002");
            }
        }

        // 删除操作
        function removeItem() {
            var rows = grid.getSelecteds();
            if (rows.length > 0) {
                if (grid.hasChildren(grid.getSelectedNode())) {
                    businessMessage.alert("Q00004", null, function() {
                        doAjax("/S0100403Departments/delete", rows[0], function(obj) {
                            if (obj.status == "SUCCESS") {
                                businessMessage.alert(obj.text);
                                grid.reload();
                            }
                        });
                    });
                } else {
                    businessMessage.alert("Q00001", null, function() {
                        doAjax("/S0100403Departments/delete", rows[0], function(obj) {
                            if (obj.status == "SUCCESS") {
                                businessMessage.alert(obj.text);
                                grid.reload();
                            }
                        });
                    });
                }
            } else {
                businessMessage.alert("E00002");
            }
        }
    </script>
</body>

</html>