<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>公司基本信息编辑</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="../boot.js" type="text/javascript"></script>
</head>

<body class="no-skin">

    <div class="edit-page-content">
        <div id="form1" th:object="${formdata}" class="form-horizontal" style="width: 100%; height: 100%;">
            <input id="id" class="mini-hidden" th:field="*{id}" />
            <div>
                <div class="tab-content profile-edit-tab-content">
                    <div id="edit-basic" class="tab-pane in active">
                        <h4 class="header blue bolder smaller">基本信息</h4>

                        <div class="vspace-12-sm"></div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">公司名:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="companyname" th:field="*{companyname}" vtype="maxLength:50" required="true" />
                            </div>

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">公司名简称:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="shortname" th:field="*{shortname}" vtype="maxLength:50" required="true" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">公司名(英语):</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="companynameen" th:field="*{companynameen}" vtype="halfonly;maxLength:100" required="true" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">联系电话:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="tel" th:field="*{tel}" vtype="maxLength:20" required="true" />
                            </div>

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">FAX:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="fax" th:field="*{fax}" vtype="maxLength:20" required="false" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">邮编:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="postalcode" th:field="*{postalcode}" vtype="maxLength:20" required="true" />
                            </div>


                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">Mail:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="200" id="mail" th:field="*{mail}" vtype="email;maxLength:100" required="true" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-companyname">地址:</label>
                            <div class="col-sm-3">
                                <input class="mini-textbox" width="570" id="address" th:field="*{address}" vtype="maxLength:100" required="true" />
                            </div>
                        </div>

                        <div class="space-4"></div>

                        <h4 class="header blue bolder smaller">账户信息</h4>
                        <div>
                            <div class="mini-toolbar" style="border-bottom:0;padding:0px;">
                                <table style="width:100%;">
                                    <tr>
                                        <td style="width:100%;">
                                            <a class="mini-button" iconCls="icon-add" onclick="addRow()" plain="true" tooltip="增加...">添加</a>
                                            <span class="separator"></span>
                                            <a class="mini-button" iconCls="icon-remove" onclick="removeRow()" plain="true">删除</a>

                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="">
                                <div id="accountGrid" class="mini-datagrid" allowCellEdit="true" th:url="@{/S9910Customs/getDeliveryaddress}" idField="id" allowResize="false"  allowCellSelect="true" multiSelect="false"  editNextOnEnterKey="true" sortOrder="asc"
                                    showPager="false">
                                    <div property="columns">
                                        <div type="checkcolumn"></div>
                                        <div field="bank" width="120" headerAlign="center" sortField="bank" allowSort="true">银行&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textbox" style="width:100%;" />
                                        </div>
                                        <div field="branch" width="180" headerAlign="center" sortField="branch" allowSort="true">支行名&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textbox" style="width:100%;" />
                                        </div>
                                        <div field="banknum" width="150" headerAlign="center" sortField="banknum" align="center" allowSort="true">银行账号&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textbox" style="width:100%;" />
                                        </div>
                                        <div field="account" width="150" headerAlign="center" sortField="account" align="center" allowSort="true">账户&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textbox" style="width:100%;" />
                                        </div>
                                        <div field="holder" width="100" headerAlign="center" sortField="holder" allowSort="true"> 账户名义&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textbox" style="width:100%;" />
                                        </div>
                                        <div field="type" displayField="typename" width="100" headerAlign="center" sortField="type" allowSort="true">种类&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-combobox" style="width:100%;" valueField="kbncd" textField="kbnname" data="[{kbncd:'1',kbnname:'普通預金'},{kbncd:'2',kbnname:'当座預金'}]" />
                                        </div>
                                        <div field="remark" width="200" headerAlign="center" sortField="remark" allowSort="true">备注&nbsp;<i class="ace-icon fa fa-pencil-square-o"></i>
                                            <input property="editor" class="mini-textarea" style="width:200px;" minHeight="50" />
                                        </div>
                                        <div type="checkboxcolumn" field="default" trueValue="true" falseValue="false" width="60" headerAlign="center" multiSelect="false">default</div>
                                        <div field="delflg" width="80" headerAlign="center" sortField="delflg" allowSort="true" align="center">删除状态&nbsp;
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; padding: 10px;">
                    <a class="mini-button btn btn-info btn-round " onclick="onOk()" type="button">
                        <i class="ace-icon fa fa-floppy-o bigger-110"></i> 确 定
                    </a> &nbsp; &nbsp;
                    <a class="mini-button btn btn-danger btn-round" onclick="onCancel()" type="button">
                        <i class="ace-icon fa fa-undo bigger-110"></i> 取 消
                    </a>
                </div>
            </div>
        </div>
        <!-- /.page-content -->

        <script type="text/javascript">
            var form = new mini.Form("#form1");
            mini.parse();
            var accountGrid = mini.get("accountGrid");


            var accountData = new Array();
            for (var i = 0; i < 4; i++) {
                accountData.push({
                    bank: "中国银行",
                    branch: "中国银行青岛市浮山所支行",
                    banknum: "100" + i,
                    account: "100" + i,
                    holder: "张三",
                    type: "1",
                    typename: "活期存款",
                    remark: "测试帐户",
                    delflg: "未删除"
                });
            }
            accountGrid.setData(accountData);

            function SetData(data) {
                mini.get("companyname").setValue(data.companyname);
                mini.get("shortname").setValue(data.shortname);
                mini.get("companynameen").setValue(data.companynameen);
                mini.get("postalcode").setValue(data.postalcode);
                mini.get("address").setValue(data.address);
                mini.get("tel").setValue(data.tel);
                mini.get("fax").setValue(data.fax);
                mini.get("mail").setValue(data.mail);
                mini.get("centertel").setValue("092-666-1234");
                mini.get("centerfax").setValue("092-666-1234");
                mini.get("centerpost").setValue("811-2302");
                mini.get("centeraddress").setValue("福冈县福冈市博多区福冈国际机场北");
                //mini.get("sealimg").setValue(data.sealimg);
            }

            function removeRow() {
                debugger;
                var rows = accountGrid.getSelecteds();
                if (rows.length > 0) {

                    var rowData = {
                        delflg: "已删除"
                    };
                    accountGrid.updateRow(rows[0], rowData);
                }

            }


            // 保存操作
            function onOk() {
                form.validate();
                if (form.isValid() == false) {
                    //businessMessage.alert("E0009");
                    return;
                }
                //businessMessage.alert("Q0002", null, oksave);

                var data = {
                    companyname: mini.get("companyname").getValue(),
                    shortname: mini.get("shortname").getValue(),
                    companynameen: mini.get("companynameen").getValue(),
                    postalcode: mini.get("postalcode").getValue(),
                    address: mini.get("address").getValue(),
                    tel: mini.get("tel").getValue(),
                    fax: mini.get("fax").getValue(),
                    mail: mini.get("mail").getValue(),
                    bank: mini.get("bank").getValue(),
                    accounttype: mini.get("accounttype").getValue(),
                    account: mini.get("account").getValue(),
                    accountname: mini.get("accountname").getValue(),
                    //sealimg: mini.get("sealimg").getValue()
                };

                window.Owner.saveData(data);

                window.CloseOwnerWindow();
            }

            function oksave() {
                var data = form.getData();
                var accessurl = "";
                if (mini.get("mode").value == "2") {
                    accessurl = "/S9905CompanyInfo/add";
                } else {
                    accessurl = "/S9905CompanyInfo/update";
                }
                doAjax(accessurl, data, function(obj) {
                    if (obj.status == "SUCCESS") {
                        businessMessage.alert("I0001", null, function() {
                            CloseWindow("ok");
                        });
                    } else {
                        businessMessage.alert(obj.text);
                        return;
                    }
                });
            }

            // 初始化时focus
            function loadfocus() {
                mini.get("companyname").focus();
            }
        </script>
</body>

</html>