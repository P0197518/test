<!DOCTYPE html>
<html>

<head>
    <title>资源管理</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="../boot.js" type="text/javascript"></script>
    <script src="../ace/aceui/locale/ja_JP.js" type="text/javascript"></script>
</head>

<body class="no-skin">
    <div class="mini-toolbar" style="/* border-bottom:0; */padding:0px;border-top:0;margin-top:5px;margin-bottom:5px;">
        <table style="width:100%;">
            <tr>
                <td style="width:100%;">
                    <a class="mini-button btn btn-warning btn-round" onclick="add()" id="btnAdd" type="button">
                        <i class="ace-icon fa fa-plus-circle bigger-110"></i>添加
                    </a>
                    <a class="mini-button btn btn-success btn-round" onclick="edit()">
                        <i class="ace-icon fa fa-pencil-square-o"></i>编辑
                    </a>
                    <a class="mini-button btn btn-danger btn-round" onclick="removeItem()">
                        <i class="ace-icon fa fa-times-circle"></i>删除
                    </a>
                </td>
            </tr>
        </table>
    </div>

    <div class="mini-fit">
        <div id="grid1" class="mini-treegrid" style="width:100%;height:100%;" showTreeIcon="true" treeColumn="resourcename" idField="UID" parentField="ParentTaskUID" resultAsTree="false" allowResize="false" expandOnLoad="true" " ()"
            onSelectionchanged="selectionchanged()">
            <div property="columns">
                <div type="checkcolumn">选择</div>
                <div name="resourcename" field="resourcename" width="160">资源名</div>
                <div field="resourceurl" headerAlign="center" align="left" width="80">资源路径</div>
                <div field="imgvalue" headerAlign="center" align="left" width="80">图标</div>
                <div field="moduleid" headerAlign="center" align="left" width="80">ModuleID</div>
                <div field="sortorder" headerAlign="center" align="left" width="80">序号</div>
                <div field="cz" width="80" headerAlign="center" align="left" renderer="onActionRenderer">操作</div>
            </div>
        </div>
    </div>


    <script type="text/javascript">
        document.onclick = function() {
            window.parent.hideMenu();
        }



        mini.parse();

        var grid = mini.get("grid1");
        //grid.load();
        grid.hideColumn("idColumn");

        var gridData = new Array();



        gridData.push({

            "UID": "1",
            "resourcename": "在库管理",
            "resourceurl": "../asdads/",
            "imgvalue": "",
            "moduleid": "在库管理",
            "sortorder": "1",
            "PredecessorLink": [],
            "ParentTaskUID": "-1",
        }, {
            "UID": "2",
            "resourcename": "在库查询",
            "resourceurl": "../asdads/",
            "imgvalue": "d://ads/ad/adsda/asd.jpg",
            "moduleid": "E01002",
            "sortorder": "01",
            "PredecessorLink": [],
            "ParentTaskUID": "1",
        }, {
            "UID": "3",
            "resourcename": "在库估算查询",
            "resourceurl": "../asdads/",
            "imgvalue": "d://ads/ad/adsda/asd.jpg",
            "moduleid": "E01003",
            "sortorder": "02",
            "PredecessorLink": [],
            "ParentTaskUID": "1",
        }, {
            "UID": "4",
            "resourcename": "产品入库",
            "resourceurl": "../asdads/",
            "imgvalue": "d://ads/ad/adsda/asd.jpg",
            "moduleid": "E01004",
            "sortorder": "03",
            "PredecessorLink": [],
            "ParentTaskUID": "1",
        }, {
            "UID": "5",
            "resourcename": "收付款管理",
            "resourceurl": "../asdads/",
            "imgvalue": "",
            "moduleid": "收付款管理",
            "sortorder": "1",
            "PredecessorLink": [],
            "ParentTaskUID": "",
        }, {
            "UID": "6",
            "resourcename": "订货支付申请",
            "resourceurl": "../asdads/",
            "imgvalue": "d://ads/ad/adsda/asd.jpg",
            "moduleid": "C01001",
            "sortorder": "01",
            "PredecessorLink": [],
            "ParentTaskUID": "5",
        }, {
            "UID": "7",
            "resourcename": "订货支付申请确认",
            "resourceurl": "../asdads/",
            "imgvalue": "d://ads/ad/adsda/asd.jpg",
            "moduleid": "C01001",
            "sortorder": "02",
            "PredecessorLink": [],
            "ParentTaskUID": "5",
        })

        grid.loadList(gridData, "UID", "ParentTaskUID")


        function onActionRenderer(e) {
            if (e.row.type == "PARENT") {
                return "";
            }
            return '<a class="New_Button" href="#" onclick="javascript:window.movement()"><i class="fa fa-cog fa-lg red" aria-hidden="true"></i>动作设置</a>';
        }


        function showAction() {
            var tree = mini.get("grid1");
            var row = grid.getSelected();
            if (!tree.hasChildren(tree.getSelectedNode())) {
                mini.open({
                    //url: "/XRYY/resource/backend_res!auth.action?parentid="+row.id,
                    type: "get",
                    title: "权限操作",
                    width: 850,
                    height: 600,
                    onload: function() {
                        //// var iframe = this.getIFrameEl();
                        //   var data = { action: "new"};
                    },
                    ondestroy: function(action) {

                        //grid.reload();
                    }
                });
            } else {
                mini.alert("所有权限在首页菜单中没有操作权限！");
            }

        }

        function selectionchanged() {
            var rows = grid.getSelecteds();
            if (rows.length > 0) {
                //mini.get("btnEdit").setEnabled(true);
                //mini.get("btnDelete").setEnabled(true);
            } else {
                //mini.get("btnEdit").setEnabled(false);
                //mini.get("btnDelete").setEnabled(false);
            }
        }

        function movement() {
            var popWindow = {
                url: "P0717ResourceMovement.html",
                title: "权限管理",
                width: 850,
                height: 600,
                onload: function() {},
                ondestroy: function(action) {}
            };
            mini.open(popWindow);
        }

        // 添加操作
        function add() {

            var popWindow = {
                url: "P0717ResourceEdit.html",
                title: "资源管理",
                width: 850,
                height: 600,
                onload: function() {},
                ondestroy: function(action) {}
            };
            mini.open(popWindow);
        }




        //编辑操作
        function edit() {
            var row = grid.getSelected();
            var popWindow = {
                url: "P0717ResourceEdit.html",
                title: "资源编辑",
                width: 850,
                height: 600,
                onload: function() {},
                ondestroy: function(action) {}
            };
            mini.open(popWindow);
        }

        function removeItem() {
            var row = grid.getSelected();
            if (row) {
                var tree = mini.get("grid1");
                var list = tree.getAllChildNodes(tree.getSelectedNode());
                var ids = row.id;
                var haschildren = tree.hasChildren(tree.getSelectedNode());
                var message = "确定要删除选定行的数据吗?";
                if (haschildren) {
                    for (var i = 0; i < list.length; i++) {
                        ids = ids + "," + list[i].id;
                    }
                    message = "此数据带有子数据，确定要删除该数据及其子数据吗？";
                }

                mini.confirm(message, "确定?", function(action) {
                    if (action == "ok") {
                        doAjaxBackJson("/XRYY/resource/backend_res!delete.action?id=" + ids,
                            null,
                            function(obj) {
                                if (obj.status == "success") {
                                    mini.alert("删除成功！");
                                    grid.reload();
                                } else {
                                    alert(obj.message);
                                    grid.reload();
                                }
                            });
                    }
                });
            } else {
                mini.alert("请选中一条记录");
            }
        }

        function search() {
            var key = mini.get("key").getValue();
            grid.load({
                key: key
            });
        }
        /////////////////////////////////////////////////
        function onBirthdayRenderer(e) {
            var value = e.value;
            if (value) return mini.formatDate(value, 'yyyy-MM-dd');
            return "";
        }

        function onMarriedRenderer(e) {
            if (e.value == 1) return "是";
            else return "否";
        }
        var Genders = [{
            id: 1,
            text: '男'
        }, {
            id: 2,
            text: '女'
        }];

        function onGenderRenderer(e) {
            for (var i = 0, l = Genders.length; i < l; i++) {
                var g = Genders[i];
                if (g.id == e.value) return g.text;
            }
            return "";
        }
    </script>


</body>

</html>