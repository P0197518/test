<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>资源编辑</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="../boot.js" type="text/javascript"></script>
    <script src="../ace/aceui/locale/ja_JP.js" type="text/javascript"></script>
</head>

<body onload="loadfocus()">

    <div class="edit-page-content">
        <div id="form1" th:object="${formdata}" class="form-horizontal" style="width: 100%; min-width: 800px;">
            <input id="id" class="mini-hidden" th:field="*{id}" />
            <input id="mode" class="mini-hidden" th:field="*{mode}" />
            <div>
                <div class="tab-content profile-edit-tab-content">
                    <div id="edit-basic" class="tab-pane in active">
                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">资源名:</label>

                            <div class="col-sm-3">
                                <input name="resourcename" id="resourcename" class="mini-textbox" value="" vtype="maxLength:30" required="true" requiredErrorText="不得为空" />
                            </div>

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">图标：</label>

                            <div class="col-sm-3">
                                <input name="imgvalue" id="imgvalue" class="mini-textbox" value="" />
                            </div>
                        </div>

                        <div class="space-4"></div>

                        <div class="form-group">
                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">资源路径:</label>

                            <div class="col-sm-3">
                                <input name="resourceurl" id="resourceurl" class="mini-textbox" vtype="maxLength:50" value="" required="true" requiredErrorText="不得为空" />
                            </div>

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">ModuleId:</label>

                            <div class="col-sm-3">
                                <input name="moduleid" id="moduleid" class="mini-textbox" vtype="maxLength:30" required="true" value="" />
                            </div>
                        </div>

                        <div class="space-4"></div>

                        <div class="form-group">

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">父资源:</label>

                            <div class="col-sm-3">
                                <input id="parentid" name="parentid" class="mini-buttonedit" onbuttonclick="onButtonEdit" value="" text="" />
                            </div>

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">序号：</label>

                            <div class="col-sm-3">
                                <input name="sortorder" id="sortorder" class="mini-textbox" vtype="maxLength:20; int" value="" vtype="float" required="true" requiredErrorText="不得为空" />
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-1 control-label no-padding-right" for="form-field-username">是否显示:</label>

                            <div class="col-sm-3">
                                <input id="showinmenu" name="showinmenu" class="mini-combobox" textField="text" valueField="id" value="1" data='[{id:"1",text:"显示"},{id:"0",text:"隐藏"}]' />
                            </div>
                        </div>


                        <div class="space-4"></div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; padding: 10px;">
                <a class="mini-button btn btn-info btn-round " onclick="onOk()" type="button">
                    <i class="ace-icon fa fa-floppy-o bigger-110"></i> 确 定
                </a> &nbsp; &nbsp;
                <a class="mini-button btn btn-warning btn-round" onclick="onCancel()" type="button">
                    <i class="ace-icon fa fa-undo bigger-110"></i> 取 消
                </a>
            </div>
        </div>
    </div>
    <!-- /.page-content -->

    <script type="text/javascript">
        var form = new mini.Form("#form1");
        mini.parse();

        function onButtonEdit(e) {
            var btnEdit = this;
            mini.open({
                url: "P0717ResourceResource.html",
                showMaxButton: false,
                title: "父资源",
                width: 430,
                height: 400,
                ondestroy: function(action) {
                    if (action == "ok") {
                        var iframe = this.getIFrameEl();
                        var data = iframe.contentWindow.GetData();
                        data = mini.clone(data);

                        if (mini.get("id").getValue() == data.id) {
                            mini.alert("父级部门不能是自己！");
                            return;
                        }
                        if (data) {
                            btnEdit.setValue(data.id);
                            btnEdit.setText(data.resourcename);
                        }
                    } else if (action == "clear") {
                        btnEdit.setValue("");
                        btnEdit.setText("");
                    }
                }
            });
        }

        function onOk() {
            form.validate();
            if (form.isValid() == false) {
                businessMessage.alert("E0009");
                return;
            }
            var data = form.getData();
            var json = mini.encode(data);
            mini.confirm(businessMessage.get("Q0023"), "确认", function(action) {
                if (action == "ok") {
                    doAjaxBackJson("../resource/backend_res!saveorupdate.action", {
                            submitData: json,
                            oldresourcename: mini.get("oldresourcename").getValue()
                        },
                        function(obj) {
                            if (obj.status == "success") {
                                mini.alert("保存成功！", "提示", function() {
                                    CloseWindow("ok");
                                });
                            } else {
                                mini.alert(obj.message);
                            }
                        });
                }
            });
        }

        function onCancel(e) {
            CloseWindow("cancel");
        }

        function CloseWindow(action) {
            if (action == "close" && form.isChanged()) {
                if (confirm("数据被修改了，是否先保存？")) {
                    return false;
                }
            }
            if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
            else window.close();
        }
        // 初始化时focus
        function loadfocus() {
            mini.get("resourcename").focus();
        }
    </script>
</body>

</html>